Assumptions:

Only 'deposit' transactions can be disputed;
If any transaction fails the whole process should terminate, there's no partial success;
An attempt to withdraw more funds than available triggers an error;
Negative balance is possible in case of deposit-withdraw-dispute-chargeback;
Locked state is only an indicator of chargeback and doesn't impact any operation;